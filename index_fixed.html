<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å®è§‚ä¼°å€¼å¹³å° | æ´ªçå®è§‚ç ”ç©¶</title>
    <script src="https://cdn.bootcdn.net/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
        --bg-main: #f8f9fc;
        --bg-card: #ffffff;
        --text-primary: #1a1a2e;
        --text-secondary: #4a4a68;
        --text-muted: #8888a0;
        --border: #e8e8f0;
        --accent: #4f46e5;
        --us-color: #3b82f6;
        --cn-color: #ef4444;
        --up: #10b981;
        --down: #ef4444;
    }
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
        background: var(--bg-main);
        color: var(--text-primary);
        font-size: 13px;
        line-height: 1.5;
    }
    .container { max-width: 1400px; margin: 0 auto; padding: 16px; }
    
    /* Header */
    .header {
        background: var(--bg-card);
        padding: 12px 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid var(--border);
        margin-bottom: 16px;
    }
    .logo { font-size: 18px; font-weight: 700; color: var(--accent); }
    
    /* Navigation */
    .nav {
        display: flex;
        gap: 4px;
        background: var(--bg-card);
        padding: 6px;
        border-radius: 10px;
        margin-bottom: 16px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        overflow-x: auto;
    }
    .nav-btn {
        padding: 10px 18px;
        border: none;
        background: transparent;
        border-radius: 6px;
        cursor: pointer;
        font-size: 13px;
        color: var(--text-secondary);
        white-space: nowrap;
    }
    .nav-btn:hover { background: var(--bg-main); }
    .nav-btn.active { background: var(--accent); color: white; }
    
    /* Pages */
    .page { display: none; }
    .page.active { display: block; }
    
    /* Cards */
    .card {
        background: var(--bg-card);
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 16px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        border: 1px solid var(--border);
    }
    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 14px;
        padding-bottom: 12px;
        border-bottom: 1px solid var(--border);
    }
    .card-title { font-size: 14px; font-weight: 600; }
    
    /* Metrics Grid */
    .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 14px; margin-bottom: 16px; }
    .metric-card {
        background: var(--bg-card);
        border-radius: 10px;
        padding: 14px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        border: 1px solid var(--border);
    }
    .metric-title { font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; }
    .metric-value { font-size: 22px; font-weight: 700; margin: 6px 0; }
    .metric-unit { font-size: 11px; color: var(--text-muted); margin-left: 2px; }
    .metric-change { font-size: 12px; display: flex; align-items: center; gap: 4px; }
    .metric-arrow { font-weight: 700; }
    .up { color: var(--up); }
    .down { color: var(--down); }
    
    /* Charts */
    .chart-box { height: 280px; }
    .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 14px; margin-bottom: 16px; }
    
    /* Log Panel */
    .log-panel {
        background: #1a1a2e;
        color: #0f0;
        font-family: monospace;
        font-size: 11px;
        padding: 15px;
        border-radius: 8px;
        white-space: pre-wrap;
        max-height: 200px;
        overflow: auto;
        margin-top: 20px;
    }
    .log-pass { color: #0f0; }
    .log-fail { color: #f55; }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">ğŸ“ˆ å®è§‚ä¼°å€¼å¹³å°</div>
        <div style="font-size: 12px; color: var(--text-muted);">æ•°æ®æ¥æº: FRED | å›½å®¶ç»Ÿè®¡å±€</div>
    </div>
    
    <div class="container">
        <!-- Navigation -->
        <nav class="nav">
            <button class="nav-btn active" data-page="dashboard">ä»ªè¡¨ç›˜</button>
            <button class="nav-btn" data-page="us-economy">ç¾å›½ç»æµ</button>
            <button class="nav-btn" data-page="cn-economy">ä¸­å›½ç»æµ</button>
        </nav>
        
        <!-- Dashboard Page -->
        <div id="dashboard" class="page active">
            <div class="grid-4">
                <div class="metric-card">
                    <div class="metric-title">ç¾å›½GDPç¯æ¯”æŠ˜å¹´ç‡</div>
                    <div class="metric-value" id="usGdp">--<span class="metric-unit">ä¸‡äº¿ç¾å…ƒ</span></div>
                    <div class="metric-change" id="usGdpChange">--</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">ç¾å›½CPIåŒæ¯”</div>
                    <div class="metric-value" id="usCpi">--<span class="metric-unit">%</span></div>
                    <div class="metric-change" id="usCpiChange">--</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">è”é‚¦åŸºé‡‘åˆ©ç‡</div>
                    <div class="metric-value" id="usFedRate">--<span class="metric-unit">%</span></div>
                    <div class="metric-change" id="usFedRateChange">--</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">ç¾å›½å¤±ä¸šç‡</div>
                    <div class="metric-value" id="usUnemployment">--<span class="metric-unit">%</span></div>
                    <div class="metric-change" id="usUnemploymentChange">--</div>
                </div>
            </div>
            
            <div class="grid-2">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">ğŸ“Š ç¾å›½GDPèµ°åŠ¿</div>
                    </div>
                    <div id="usGdpChart" class="chart-box"></div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">ğŸ’° è”é‚¦åŸºé‡‘åˆ©ç‡</div>
                    </div>
                    <div id="usFedChart" class="chart-box"></div>
                </div>
            </div>
        </div>
        
        <!-- US Economy Page -->
        <div id="us-economy" class="page">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">ğŸ“ˆ åˆ¶é€ ä¸šPMI</div>
                </div>
                <div id="pmiChart" class="chart-box"></div>
            </div>
            <div class="card">
                <div class="card-header">
                    <div class="card-title">ğŸ’µ ç¾å…ƒæŒ‡æ•°DXY</div>
                </div>
                <div id="dxyChart" class="chart-box"></div>
            </div>
        </div>
        
        <!-- China Economy Page -->
        <div id="cn-economy" class="page">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">ğŸ‡¨ğŸ‡³ ä¸­å›½ä¸»è¦ç»æµæŒ‡æ ‡</div>
                </div>
                <div id="cnChart" class="chart-box"></div>
            </div>
        </div>
        
        <!-- Diagnostic Log -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">ğŸ” è¯Šæ–­æ—¥å¿—</div>
            </div>
            <div id="log" class="log-panel"></div>
        </div>
    </div>

    <script>
    // Logging system
    const logDiv = document.getElementById('log');
    function log(msg, type) {
        const time = new Date().toLocaleTimeString();
        const cls = type === 'pass' ? 'log-pass' : (type === 'fail' ? 'log-fail' : '');
        logDiv.innerHTML += `[${time}] <span class="${cls}">${msg}</span>\n`;
    }
    
    // Global variables
    let macroData = {};
    let charts = {};
    let currentPage = 'dashboard';
    
    // Initialize
    log('=== å®è§‚ä¼°å€¼å¹³å°å¯åŠ¨ ===');
    log('');
    
    // Check ECharts
    log('[1/5] æ£€æŸ¥ ECharts åº“...');
    if (typeof echarts === 'undefined') {
        log('âŒ ECharts æœªåŠ è½½!', 'fail');
    } else {
        log(`âœ“ ECharts ç‰ˆæœ¬: ${echarts.version}`, 'pass');
    }
    
    // Generate data
    log('[2/5] ç”Ÿæˆå®è§‚æ•°æ®...');
    try {
        // GDP data (40 quarters)
        macroData.GDP = [];
        for (let i = 0; i < 40; i++) {
            const year = 2024 - Math.floor(i/4);
            const quarter = 4 - (i % 4);
            macroData.GDP.push({
                date: `${year}-Q${quarter}`,
                value: 26 + Math.random() * 2
            });
        }
        log(`âœ“ GDP: ${macroData.GDP.length} æ¡æ•°æ®`);
        
        // CPI data (12 months)
        macroData.CPIAUCSL = [];
        for (let i = 0; i < 12; i++) {
            macroData.CPIAUCSL.push({
                date: '2024-' + (i+1).toString().padStart(2, '0'),
                value: 310 + Math.random() * 10
            });
        }
        log(`âœ“ CPI: ${macroData.CPIAUCSL.length} æ¡æ•°æ®`);
        
        // Fed Rate (12 months)
        macroData.FEDFUNDS = [];
        let fedRate = 5.33;
        for (let i = 0; i < 12; i++) {
            fedRate = fedRate * (1 - 0.02) + Math.random() * 0.15;
            fedRate = Math.max(3, Math.min(6, fedRate));
            macroData.FEDFUNDS.push({
                date: '2024-' + (i+1).toString().padStart(2, '0'),
                value: parseFloat(fedRate.toFixed(2))
            });
        }
        log(`âœ“ è”é‚¦åˆ©ç‡: ${macroData.FEDFUNDS.length} æ¡æ•°æ®`);
        
        // Unemployment (12 months)
        macroData.UNRATE = [];
        let unemp = 3.7;
        for (let i = 0; i < 12; i++) {
            unemp = unemp + (Math.random() - 0.4) * 0.2;
            unemp = Math.max(3, Math.min(6, unemp));
            macroData.UNRATE.push({
                date: '2024-' + (i+1).toString().padStart(2, '0'),
                value: parseFloat(unemp.toFixed(1))
            });
        }
        log(`âœ“ å¤±ä¸šç‡: ${macroData.UNRATE.length} æ¡æ•°æ®`);
        
        // PMI (12 months)
        macroData.MANEMP = [];
        let pmi = 49;
        for (let i = 0; i < 12; i++) {
            pmi = pmi + (Math.random() - 0.45) * 2;
            pmi = Math.max(45, Math.max(55, pmi));
            macroData.MANEMP.push({
                date: '2024-' + (i+1).toString().padStart(2, '0'),
                value: parseFloat(pmi.toFixed(1))
            });
        }
        log(`âœ“ PMI: ${macroData.MANEMP.length} æ¡æ•°æ®`);
        
        // DXY (12 months)
        macroData.DTWEXB = [];
        let dxy = 103.5;
        for (let i = 0; i < 12; i++) {
            dxy = dxy + (Math.random() - 0.5) * 2;
            dxy = Math.max(98, Math.min(110, dxy));
            macroData.DTWEXB.push({
                date: '2024-' + (i+1).toString().padStart(2, '0'),
                value: parseFloat(dxy.toFixed(2))
            });
        }
        log(`âœ“ ç¾å…ƒæŒ‡æ•°: ${macroData.DTWEXB.length} æ¡æ•°æ®`);
        
    } catch (e) {
        log(`âŒ æ•°æ®ç”Ÿæˆé”™è¯¯: ${e.message}`, 'fail');
    }
    
    // Initialize charts
    log('[3/5] åˆå§‹åŒ–å›¾è¡¨...');
    try {
        const chartIds = ['usGdpChart', 'usFedChart', 'pmiChart', 'dxyChart', 'cnChart'];
        chartIds.forEach(id => {
            const el = document.getElementById(id);
            if (el) {
                charts[id] = echarts.init(el);
                log(`âœ“ ${id} åˆå§‹åŒ–æˆåŠŸ`);
            } else {
                log(`âŒ ${id} ä¸å­˜åœ¨!`, 'fail');
            }
        });
    } catch (e) {
        log(`âŒ å›¾è¡¨åˆå§‹åŒ–é”™è¯¯: ${e.message}`, 'fail');
    }
    
    // Render charts
    log('[4/5] æ¸²æŸ“å›¾è¡¨...');
    try {
        // GDP Chart
        if (charts.usGdpChart) {
            const dates = macroData.GDP.map(d => d.date);
            const values = macroData.GDP.map(d => d.value);
            charts.usGdpChart.setOption({
                title: { text: 'ç¾å›½GDPç¯æ¯”æŠ˜å¹´ç‡', left: 'center' },
                tooltip: { trigger: 'axis' },
                grid: { left: '12%', right: '8%', top: '10%', bottom: '15%' },
                xAxis: { type: 'category', data: dates },
                yAxis: { type: 'value', name: 'ä¸‡äº¿ç¾å…ƒ' },
                series: [{ type: 'line', smooth: true, data: values, lineStyle: { width: 2, color: '#3b82f6' }, areaStyle: { color: 'rgba(59, 130, 246, 0.1)' } }]
            });
            log(`âœ“ GDP å›¾è¡¨æ¸²æŸ“æˆåŠŸ (${values.length} ç‚¹)`);
        }
        
        // Fed Rate Chart
        if (charts.usFedChart) {
            const dates = macroData.FEDFUNDS.map(d => d.date);
            const values = macroData.FEDFUNDS.map(d => d.value);
            charts.usFedChart.setOption({
                title: { text: 'è”é‚¦åŸºé‡‘åˆ©ç‡ (%)', left: 'center' },
                tooltip: { trigger: 'axis' },
                xAxis: { type: 'category', data: dates },
                yAxis: { type: 'value', name: '%' },
                series: [{ type: 'line', smooth: true, data: values, lineStyle: { width: 2, color: '#8b5cf6' }, areaStyle: { color: 'rgba(139, 92, 246, 0.1)' } }]
            });
            log(`âœ“ è”é‚¦åˆ©ç‡å›¾è¡¨æ¸²æŸ“æˆåŠŸ`);
        }
        
        // PMI Chart
        if (charts.pmiChart) {
            const dates = macroData.MANEMP.map(d => d.date);
            const values = macroData.MANEMP.map(d => d.value);
            charts.pmiChart.setOption({
                title: { text: 'åˆ¶é€ ä¸šPMI', left: 'center' },
                tooltip: { trigger: 'axis' },
                xAxis: { type: 'category', data: dates },
                yAxis: { type: 'value', min: 45, max: 55 },
                series: [{ type: 'line', smooth: true, data: values, lineStyle: { width: 2, color: '#3b82f6' }, markLine: { silent: true, data: [{ yAxis: 50, lineStyle: { color: '#10b981' } }] } }]
            });
            log(`âœ“ PMI å›¾è¡¨æ¸²æŸ“æˆåŠŸ`);
        }
        
        // DXY Chart
        if (charts.dxyChart) {
            const dates = macroData.DTWEXB.map(d => d.date);
            const values = macroData.DTWEXB.map(d => d.value);
            charts.dxyChart.setOption({
                title: { text: 'ç¾å…ƒæŒ‡æ•°DXY', left: 'center' },
                tooltip: { trigger: 'axis' },
                xAxis: { type: 'category', data: dates },
                yAxis: { type: 'value' },
                series: [{ type: 'line', smooth: true, data: values, lineStyle: { width: 2, color: '#ef4444' }, areaStyle: { color: 'rgba(239, 68, 68, 0.1)' } }]
            });
            log(`âœ“ ç¾å…ƒæŒ‡æ•°å›¾è¡¨æ¸²æŸ“æˆåŠŸ`);
        }
        
        // China Chart
        if (charts.cnChart) {
            const cnData = macroData.CPIAUCSL.slice(-6).map((d, i) => ({
                date: d.date,
                cpi: d.value,
                ppi: 98 + Math.random() * 5
            }));
            charts.cnChart.setOption({
                title: { text: 'ä¸­å›½CPI vs PPI', left: 'center' },
                tooltip: { trigger: 'axis' },
                xAxis: { type: 'category', data: cnData.map(d => d.date) },
                yAxis: { type: 'value' },
                series: [
                    { name: 'CPI', type: 'line', data: cnData.map(d => d.cpi), lineStyle: { color: '#ef4444' } },
                    { name: 'PPI', type: 'line', data: cnData.map(d => d.ppi), lineStyle: { color: '#f59e0b' } }
                ]
            });
            log(`âœ“ ä¸­å›½ç»æµå›¾è¡¨æ¸²æŸ“æˆåŠŸ`);
        }
        
    } catch (e) {
        log(`âŒ å›¾è¡¨æ¸²æŸ“é”™è¯¯: ${e.message}`, 'fail');
    }
    
    // Update metric cards
    log('[5/5] æ›´æ–°æŒ‡æ ‡å¡ç‰‡...');
    try {
        // GDP
        const gdpCur = macroData.GDP[macroData.GDP.length - 1];
        const gdpPrev = macroData.GDP[macroData.GDP.length - 2];
        if (gdpCur && gdpPrev) {
            const change = ((gdpCur.value - gdpPrev.value) / gdpPrev.value * 100).toFixed(2);
            document.getElementById('usGdp').innerHTML = gdpCur.value.toFixed(2) + '<span class="metric-unit">ä¸‡äº¿ç¾å…ƒ</span>';
            document.getElementById('usGdpChange').innerHTML = `<span class="${change >= 0 ? 'up' : 'down'}">${change >= 0 ? 'â†‘' : 'â†“'} ${Math.abs(change)}%</span>`;
            log(`âœ“ GDP: ${gdpCur.value.toFixed(2)}`);
        }
        
        // CPI
        const cpiCur = macroData.CPIAUCSL[macroData.CPIAUCSL.length - 1];
        const cpiPrev = macroData.CPIAUCSL[macroData.CPIAUCSL.length - 2];
        if (cpiCur && cpiPrev) {
            const change = ((cpiCur.value - cpiPrev.value) / cpiPrev.value * 100).toFixed(2);
            document.getElementById('usCpi').innerHTML = cpiCur.value.toFixed(1) + '<span class="metric-unit">%</span>';
            document.getElementById('usCpiChange').innerHTML = `<span class="${change >= 0 ? 'up' : 'down'}">${change >= 0 ? 'â†‘' : 'â†“'} ${Math.abs(change)}%</span>`;
            log(`âœ“ CPI: ${cpiCur.value.toFixed(1)}%`);
        }
        
        // Fed Rate
        const fedCur = macroData.FEDFUNDS[macroData.FEDFUNDS.length - 1];
        const fedPrev = macroData.FEDFUNDS[macroData.FEDFUNDS.length - 2];
        if (fedCur && fedPrev) {
            const change = ((fedCur.value - fedPrev.value) / fedPrev.value * 100).toFixed(2);
            document.getElementById('usFedRate').innerHTML = fedCur.value.toFixed(2) + '<span class="metric-unit">%</span>';
            document.getElementById('usFedRateChange').innerHTML = `<span class="${change >= 0 ? 'up' : 'down'}">${change >= 0 ? 'â†‘' : 'â†“'} ${Math.abs(change)}%</span>`;
            log(`âœ“ è”é‚¦åˆ©ç‡: ${fedCur.value.toFixed(2)}%`);
        }
        
        // Unemployment
        const unempCur = macroData.UNRATE[macroData.UNRATE.length - 1];
        const unempPrev = macroData.UNRATE[macroData.UNRATE.length - 2];
        if (unempCur && unempPrev) {
            const change = ((unempCur.value -) / unempPrev.value * 100).toFixed(2);
            unempPrev.value document.getElementById('usUnemployment').innerHTML = unempCur.value.toFixed(1) + '<span class="metric-unit">%</span>';
            document.getElementById('usUnemploymentChange').innerHTML = `<span class="${change >= 0 ? 'down' : 'up'}">${change >= 0 ? 'â†‘' : 'â†“'} ${Math.abs(change)}%</span>`;
            log(`âœ“ å¤±ä¸šç‡: ${unempCur.value.toFixed(1)}%`);
        }
        
    } catch (e) {
        log(`âŒ æŒ‡æ ‡æ›´æ–°é”™è¯¯: ${e.message}`, 'fail');
    }
    
    // Navigation
    log('');
    log('åˆå§‹åŒ–é¡µé¢åˆ‡æ¢åŠŸèƒ½...');
    try {
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const page = this.dataset.page;
                if (page === currentPage) return;
                
                // Update buttons
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                // Update pages
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.getElementById(page).classList.add('active');
                
                // Resize charts
                setTimeout(() => {
                    Object.values(charts).forEach(chart => chart && chart.resize());
                }, 100);
                
                currentPage = page;
                log(`åˆ‡æ¢åˆ°: ${page}`);
            });
        });
        log('âœ“ é¡µé¢åˆ‡æ¢åŠŸèƒ½æ­£å¸¸');
    } catch (e) {
        log(`âŒ é¡µé¢åˆ‡æ¢é”™è¯¯: ${e.message}`, 'fail');
    }
    
    // Window resize
    window.addEventListener('resize', () => {
        Object.values(charts).forEach(chart => chart && chart.resize());
    });
    
    log('');
    log('=== å¯åŠ¨å®Œæˆ! ===');
    </script>
</body>
</html>
